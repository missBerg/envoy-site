name: envoy-site-build
services:
  envoy-site:
    user: builder
    build: 
      context: ..
      dockerfile: build/build.Dockerfile
    volumes:
      - envoy_source:/home/builder/envoy
      - envoy_archive:/home/builder/envoy-archive
      - builder_tools:/home/builder/tools
      - builder_metadata:/home/builder/metadata
      - jekyll_output:/home/builder/generated
    platform: linux/amd64
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: '6G'
        reservations:
          cpus: '1.0'
          memory: '2G'

volumes:
  builder_tools:
  envoy_source:
  envoy_archive:
  builder_metadata:
  jekyll_output:
  jekyll_source:
